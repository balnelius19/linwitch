#!/bin/bash

set -e

echo "ðŸ”§ Installation du lanceur Linwitch..."

# ðŸ“ Copie des fichiers vers /opt/linwitch
INSTALL_DIR="/opt/linwitch"
mkdir -p "$INSTALL_DIR"
cp -r "$(dirname "$0")/../OS js" "$INSTALL_DIR"

# ðŸ” VÃ©rification de Midori
if ! command -v midori >/dev/null 2>&1; then
    echo "âš ï¸ Midori n'est pas installÃ©."
    read -p "Souhaitez-vous l'installer maintenant ? [O/n] " REPLY
    if [[ "$REPLY" =~ ^[Oo]$ || -z "$REPLY" ]]; then
        echo "ðŸ“¦ Installation de Midori..."
        sudo apt update && sudo apt install -y midori
    else
        echo "ðŸš« Midori ne sera pas installÃ©. Le lanceur ne fonctionnera pas sans navigateur."
    fi
else
    echo "âœ… Midori est dÃ©jÃ  installÃ©."
fi

# ðŸŒ Chemin vers index.html
INDEX_PATH="file://$INSTALL_DIR/OS js/index.html"

# ðŸ“‚ CrÃ©ation du dossier autostart
AUTOSTART_DIR="$HOME/.config/autostart"
mkdir -p "$AUTOSTART_DIR"

# ðŸ§¾ CrÃ©ation du fichier .desktop
cat > "$AUTOSTART_DIR/linwitch.desktop" <<EOF
[Desktop Entry]
Type=Application
Exec=midori -e fullscreen "$INDEX_PATH"
Hidden=false
NoDisplay=false
X-GNOME-Autostart-enabled=true
Name=Linwitch
Comment=Lance le grimoire magique au dÃ©marrage
EOF

echo "âœ… Fichier .desktop crÃ©Ã© dans $AUTOSTART_DIR"
echo "ðŸŽ‰ Installation terminÃ©e !"

